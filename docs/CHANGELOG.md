# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- **Big Fish Entity**: Implemented proper big fish as a large creature type
  - Two variants: BigFish1 (traditional, 14 lines tall) and BigFish2 (stylized, 13 lines tall)
  - BigFish1 moves at speed 3, BigFish2 at speed 2.5
  - Sprites match original Perl implementation exactly
  - Classic mode support: only spawns BigFish1 variant
  - Modern mode: 2/3 chance for BigFish2, 1/3 for BigFish1
  - Proper large creature behavior with death callbacks
  - 10 comprehensive unit tests covering both variants
  - Replaces previous placeholder that used regular fish

- **Sea Monster Classic Mode**: Added classic/old monster sprite support
  - Implemented 4-frame old monster sprites from original Perl
  - Classic mode uses old monster (4 frames, spawns at x=-64)
  - Modern mode uses new monster (2 frames, spawns at x=-54)
  - Sea monster now respects classic_mode flag

- **Random Objects Verification**: Complete verification against original Perl code
  - All 5 random objects (Ship, Whale, Sea Monster, Big Fish, Shark) verified
  - Documentation: RANDOM_OBJECTS_VERIFICATION.md, FIXES_NEEDED.md, RANDOM_OBJECTS_FIXES_COMPLETE.md
  - Test coverage increased to 71 tests (from 66)


### Fixed

- **Big Fish Depth**: Corrected depth value from 3 (FISH_START) to 2 (SHARK depth) to match original Perl
  - Original Perl uses `$depth{'shark'}` (value 2) for big fish
  - Affects rendering order and visual appearance

- **Big Fish Spawn Positions**: Fixed spawn X coordinates to match original Perl exactly
  - Variant1: Changed from computed `1 - sprite_width` to hardcoded x=-34 (right-moving)
  - Variant2: Changed from computed `1 - sprite_width` to hardcoded x=-33 (right-moving)
  - Both variants: Changed from width-2 to width-1 for left-moving fish
  - Now matches original Perl spawn behavior exactly

- **Big Fish Y Position Ranges**: Y spawn position now varies by variant height
  - Variant1 (14 lines tall): Uses height-15 constraint
  - Variant2 (13 lines tall): Uses height-14 constraint
  - Previously both variants used height-15

- **Big Fish Variant Selection**: Adjusted comparison to match original Perl logic exactly
  - Changed from `gen_range(0..3) > 0` to `gen_range(0..3) > 1`
  - Matches original `int(rand(3)) > 1` logic
  - Results in 1/3 Variant1, 2/3 Variant2 (was functionally correct but now matches source)

- **Water Surface Animation**: Water surface is now completely static, matching the original Perl implementation. Previously, the water had 8 animation frames that created a scrolling effect, which was not present in the original.
  - Removed `Animation` struct from `WaterSurface`
  - Changed `create_water_layer_sprites()` to `create_water_layer_sprite()` to create a single static sprite
  - Water surface now correctly tiles the pattern without any movement

- **Fish Spawn/Despawn Behavior**: Fish now properly swim completely on and off screen before appearing/disappearing.
  - Fixed spawn positions: Fish now start at `-sprite_width` (when moving right) or `screen_width` (when moving left)
  - Fixed death conditions: Fish only die when fully off-screen (right edge < 0 for left-moving, left edge > screen_width for right-moving)
  - Previously fish would pop in/out instantly at screen edges

- **Fish Species Selection**: Fish selection now matches original Perl implementation with proper 25%/75% distribution.
  - Implemented all 12 fish species from original (4 new + 8 old)
  - Added `FishCategory::New` and `FishCategory::Old` categorization
  - Implemented proper selection logic: `int(rand(12)) > 8` gives 25% new fish, 75% old fish
  - Added `classic_mode` flag support (disables new fish, matching original -c flag)
  - All fish sprites verified to match original Perl code character-by-character
  - Species: NewSmall1, NewSmall2, NewMedium1, NewMedium2, OldFancy, OldSimple, OldWavy, OldTiny, OldCommaLarge, OldAngledFin, OldCommaSmall, OldRounded

- **Bubble Generation**: Bubbles are now properly generated by fish and rise to the water surface.
  - Added `should_spawn_bubble()` method to `Entity` trait
  - Implemented bubble spawning in `EntityManager::update_all()`
  - Fish randomly generate bubbles based on timer (3-10 seconds interval)
  - Bubbles rise upward and pop when reaching the water surface

- **Automatic Screen Resize**: Terminal size changes now automatically trigger aquarium reinitialization.
  - Added resize detection in `App::run()` main loop
  - Implemented `on_resize()` method that clears and reinitializes all entities
  - Entity counts (fish, seaweed) now automatically scale to new terminal size
  - Previously required manual 'r' key press to redraw after resize

- **Compiler Warnings**: Fixed dead code warnings for unused `created_at` fields in `Whale`, `Ship`, and `SeaMonster` structs by adding `#[allow(dead_code)]` annotations.

### Changed

- Test count increased from 54 to 59 passing tests
  - Added test for static water surface
  - Added test for classic mode (only old fish)
  - Added test for fish species distribution (25%/75% ratio)
  - Added test for fish category assignment
  - Added test for all fish species sprites

- Code quality improvements: Fixed all 6 clippy warnings
  - Fixed field assignment outside initializer in `App::new_classic()`
  - Changed nested match to if let pattern in event handling
  - Removed module inception (nested `depth::depth` module)
  - Use `RangeInclusive::contains` instead of manual range check
  - Changed `or_insert_with(Vec::new)` to `or_default()`
  - Added `Default` implementation for `EventHandler`

## [0.1.0] - 2024

### Added

- Initial implementation of asciiquarium in Rust using ratatui
- Entity system with trait-based polymorphism
- Death callback system for population management
- Multiple fish species (6 types with randomized colors)
- Bubble entities that rise from fish
- Seaweed with sway animation
- Water surface with 4 layers
- Large creatures: Whale, Ship, Sea Monster, Shark
- Castle decoration
- Depth-based Z-ordering for proper layering
- Keyboard controls: `q` (quit), `p` (pause), `r` (redraw)
- Screen size-based entity population
- 54 unit tests covering entity behavior

### Known Issues

- Big fish implementation is currently a placeholder (uses regular fish)
- Classic mode (-c) command-line flag not yet wired to main.rs (internal support exists)

## [0.0.1] - Initial Development

- Project setup
- Basic structure and dependencies

---

[Unreleased]: https://github.com/yourusername/asciiquarium-rs/compare/v0.1.0...HEAD
[0.1.0]: https://github.com/yourusername/asciiquarium-rs/releases/tag/v0.1.0